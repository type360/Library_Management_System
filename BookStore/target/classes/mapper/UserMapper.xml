<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.briup.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.briup.pojo.User">
        <id property="id" column="id" jdbcType="INTEGER"/>
        <result property="username" column="username" jdbcType="VARCHAR"/>
        <result property="password" column="password" jdbcType="VARCHAR"/>
        <result property="phone" column="phone" jdbcType="CHAR"/>
        <result property="avatar" column="avatar" jdbcType="VARCHAR"/>
        <result property="gender" column="gender" jdbcType="CHAR"/>
        <result property="status" column="status" jdbcType="TINYINT"/>
        <result property="birthday" column="birthday" jdbcType="DATE"/>
        <result property="registerTime" column="register_time" jdbcType="TIMESTAMP"/>
        <result property="roleId" column="role_id" jdbcType="INTEGER"/>
        <result property="isVip" column="is_vip" jdbcType="BIT"/>
        <result property="vipExpirationTime" column="vip_expiration_time" jdbcType="TIMESTAMP"/>
        <result property="defaultAddressId" column="default_address_id" jdbcType="INTEGER"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,username,password,
        phone,avatar,gender,
        status,birthday,register_time,
        role_id,is_vip,vip_expiration_time
    </sql>
    <insert id="addUser">
        insert into es_user(username, password, phone, avatar, gender, status, birthday, register_time, role_id, is_vip)
        values (#{username}, #{password}, #{phone}, #{avatar}, #{gender}, #{status}, #{birthday}, #{registerTime}, #{roleId}, #{isVip})
    </insert>
    <select id="getUserByUsername" resultType="com.briup.pojo.User">
        select
        <include refid="Base_Column_List"/>
        from es_user
        where username = #{username}
    </select>

    <select id="getUserListByConditional" parameterType="com.briup.pojo.dto.UserPageDto"
            resultType="com.briup.pojo.User">
        select
        <include refid="Base_Column_List"/>
        from
        es_user
        <where>
            <if test="username != null and username != '' ">
                username like concat('%',#{username},'%')
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
            <!--如果只存在开始时间-->
            <if test="startTime != null  and startTime == null  ">
                AND register_time >= #{startTime}
            </if>
            <!--如果只存在结束时间-->
            <if test="startTime == null  and endTime != null  ">
                and register_time &lt;= #{endTime}
            </if>
            <!--如果既存在开始时间，也存在结束时间-->
            <if test="endTime != null  and endTime != null  ">
                and register_time between #{startTime} and #{endTime}
            </if>
        </where>
    </select>

    <delete id="deleteUsers">
        delete
        from es_user
        where id in
        <foreach collection="ids" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>
</mapper>
